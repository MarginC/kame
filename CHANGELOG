			CHANGELOG for KAME kit
$KAME: CHANGELOG,v 1.2354 2003/03/06 12:34:23 jinmei Exp $

<200303>
2003-03-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6/dhcp6c.c (client6_send): made sure that the
	elapsed time does not overflow, according to dhcpv6-interop-00.

<200302>
Tue Feb 25 19:50:40 JST 2003	suz@crl.hitachi.co.jp
	* freebsd{4,5}/sys/netinet/tcp_syncache.c
	  reflected FreeBSD-SA-03:03.syncookies (Brute force attack on SYN 
	  cookies)

2003-02-19  Hideki ONO  <ono@soft.net.fujitsu.co.jp>
	* kame/kame/vrrp6d,
	  kame/sys/net/{if_vrrp.c,if_vrrp_var.h},kame/sys/netinet6/mld6.c,
	  netbsd/sbin/ifconfig, netbsd/sys/net/{if_ethersubr.c,if_types.h},
	  netbsd/sys/sys/mbuf.h
	VRRP6 implementation for NetBSD
	* freebsd4/sbin/ifconfig, freebsd4/sys/net/{if_ethersubr.c,if_types.h},
	  freebsd4/sys/sys/mbuf.h
	changed VRRP6 implementation for FreeBSD4	

Wed Feb 19 17:26:11 JST 2003	keiichi@iij.ad.jp
	more mtag leaks are fidex.  M_MOVE_PKTHDR is introduced to
	NetBSD (ported from OpenBSD).
	TODO: KAME/freebsd5

Wed Feb 19 12:15:00 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netkey/key.c
	MIP6: flush a cached route of a SA when the destaddr of the SA
	has been changed.

2003-02-18  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* freebsd4/sys/sys/mbuf.h (M_MOVE_PKTHDR): ported from OpenBSD to
	"move" mtag from one mbuf to another.
	* kame/sys/netinet6/{icmp6.c, ip6_output, ipsec.c}: used
	M_MOVE_PKTHDR instead of M_COPY_PKTHDR when appropriate, in order
	to avoid mtag leakage.
	(We may need to change more, including support for other OSes)

Tue Feb 18 20:43:42 JST 2003	suz@crl.hitachi.co.jp
	* {freebsd4,netbsd,openbsd}/sys/netinet/udp_usrreq.c
	  properly handles IPv4 UDP packet for IPv4 broadcast address
	  (only for IGMPv3 kernel)

Tue Feb 18 12:19:53 JST 2003	suz@crl.hitachi.co.jp
	* {freebsd4,freebsd5,netbsd,openbsd}/sys/netinet/udp_usrreq.c
	  {freebsd4,freebsd5,kame}/sys/netinet6/udp6_usrreq.c:
	  fixed an IGMPv3 or MLDv2 kernel crash by a UDP multicast packet to 
	  addr:port, when some application joins to the addr and another 
	  application listens to the UDP port by unicast.

	  Reported by: Hitoshi Asaeda <Hitoshi.Asaeda@sophia.inria.fr>

2003-02-14  MOMOSE Tsuyoshi  <t-momose@netlab.nec.co.jp>
	*  kame/kame/sys/netinet6/{mobility6.c,mip6_pktproc.c},
	   kame/kame/sys/netinet/ip6.h
	- Changed some codes to be MIP6 ID-20 compliant.
	 + Binding Auth. Option no longer require alignments
	 + Changed Binding Refresh Advice option type
	 + Send Parameter Problem if received mobility header is too small
	   or it's next header value is not no next header.

Thu Feb 13 18:37:58 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/ifmcstat: ifmcstat works on freebsd5 now

2003-02-12  MOMOSE Tsuyoshi  <t-momose@netlab.nec.co.jp>
	* kame/sys/netinet6/{mip6.c,mip6_pktproc.c,mip6_var.h}: Only Home
	nonce is used for calculation Kbm when a binding update message
	tells to delete a binding cache.(HoA==CoA || lifetime==0)
	One of Known bugs in TODO.mobile-ip6 is fixed.

Wed Feb 12 19:09:04 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/pim6sd: fixed a pim6sd crash by SIGHUP

2003-02-10  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6/dhcp6c_ia.c (reestablish_ia): prevented the
	client from crashing when receiving a NoBinding code in response
	to a Rebind.
	Reported by: Ozoe Nobumichi <ozoe@intap.or.jp>

Mon 10 Feb 2002 14:11:46 JST	suz@crl.hitachi.co.jp
	* freebsd5/sys/netinet6/in6_pcb.c: getsockname()/getpeername() 
	  now returns proper port number for IPv6 socket.
	  (this makes rpcbind work properly on freebsd5)

2003/02/09 03:33:58 JST kjc@csl.sony.co.jp
	merge altq support into the freebsd5 tree.
	the original code was made for 5.0-dp1 and it hasn't been fully
	tested on 5.0 yet.

2003-02-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6/dhcp6c: obsoleted 'prefix-delegation' as a
	DHCPv6 option name.

2003-02-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_input.c (ip6_getpktaddrs): changed the 2nd
	and the 3rd arguments from 'sockaddr_in6 **' to 'sockaddr_in6 *'.
	The change will avoid sharing pointer in an mbuf with the caller
	of the function, and will be considered as less error-prone.
	* {*bsd, kame}/sys/netinet[6]/: all the points that called
	ip6_getpktaddrs() were modified accordingly.  There should be no
	change on behavior, but we may need some time to stabilize the
	code.

Fri Feb  7 19:40:36 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/pim6sd/{main.c, route_sock.h}: fixed file descriptor
	  leak by SIGHUP (reported by SUDOH Yoshiaki <sudo@iij.ad.jp>)

Fri Feb 7 19:17:12 JST 2003	suz@crl.hitachi.co.jp
	* freebsd5/*, kame/*: KAME for FreeBSD 5-RELEASE. (not supported
	  officially yet, as the merge work is not completely finished)

2003-02-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6: the client now sends a Request to reestablish
	an IA when receiving a NoBinding for the IA in response to a Renew
	or Rebind.  The behavior is compliant to Section 18.1.8 of
	dhcpv6-28.

Thu Feb  6 01:36:12 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/pim6sd/vif.c: fixed pim6sd crash by SIGHUP
	(reported by SUDOH Yoshiaki <sudo@iij.ad.jp>)

Wed Feb  5 20:25:32 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet/icmp6.h,ip6.h
	* kame/sys/netinet6/mip6_binding.c,mip6_pktproc.c
	* kame/kame/mip6control/mip6control.c
	- support for the MIP6 ID20 draft has been added.

2003-02-05  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* {freebsd4,kame}/sys/netinet6/udp6_usrreq.c (udp6_input)
	* {freebsd4,kame}/sys/netinet6/raw_ip6.c (rip6_input)
	removed redundant code fragments; we do not have to copy mtag back
	to the source any more.
	(There should be no change on behavior.)

Wed Feb  5 10:31:48 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet6/ip6_forward.c,ip6_output.c
	* freebsd4/sys/sys/mbuf.h
	- changed m_copy() behavior of freebsd4.  m_copy() now copies
	  mtags.

2003-02-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6/dhcp6c.c (client6_timo): changed the upper bound
	of retransmissions according to Section 14 of dhcpv6-28, so that
	the total number of transmissions (including the first one) is
	limited up to MRC.
	pointed out by: Ozoe Nobumichi <ozoe@intap.or.jp>

Mon Feb  3 18:53:50 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet6/{mip6_binding.c|ipsec.c}
	* kame/sys/netkey/key.[hc]
	- added partial support for the mip6-ha-ipsec draft.
	  define MIP6_HAIPSEC macro in your kernel config file to
	  enable optimized tunneling format.

<200301>
Fri Jan 31 21:28:08 JST 2003	keiichi@iij.ad.jp
	* kame/kame/mip6control:
	- the file format for mip6makeconfig.sh has been changed.

Thu Jan 30 15:52:05 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/pim6sd/mld6_proto.c:
	fixed a bug that MLD-compat-mode never switches back to MLDv2
	from MLDv1-compatible mode.

Thu Jan 30 13:04:25 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/pim6sd/{rp.c, cfparse.y}:
	fixed a bug that "cand_bsr/cand_rp (ifname)" does not work.
	(reported by Pekka Savola in snap-users ML #7516)

2003-01-29  MOMOSE Tsuyoshi  <t-momose@netlab.nec.co.jp>

	* kame/kame/sys/netinet6/mip6.c, mip6_var.h, mip6_pktpro.c:
	supports returning binding ack. status of expired nonce index when
	the nonces indicated in a binding update are already expired.

2003-01-27  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6: added some minor bug fixes and clarifications:
	- let the event structure to have IA for solicit and request so
	  that it is easier to handle each IA separately
	- fixed a bug that the server ID was not copied to request when
	  receiving an advertisement with the highest preference
	- fixed a bug of moving tailq list entries.  Introduced a new
	  library dhcp6_move_list() to address this problem.

Thu Jan 23 18:09:14 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet6/ip6_output.c:
	leave mtags in the original mbuf when copying the mbuf in
	ip6_mloopback().  the aux information stored in the mtags
	may be needed in the later process of the output routine.

Thu Jan 23 14:37:46 JST 2003  itojun@iijlab.net
	* sys/net/if_gif.c: detect encapsulation loop by using m_tag,
	  just like openbsd-current does.

2003-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6: supported a new substatement "prefix" for the
	id-assoc statement, which allows the client to require a
	particular prefix(es) as a subotion of the IA_PD option in Solicit
	messages.

2003-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6/dhcp6s.c (make_binding_ia): used local values
	for the pltime and vltime of a prefix to be renewed/rebound, not
	values in the renew/rebind message.

Thu Jan 23 09:26:35 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/pim6sd: 
	- fixed MLD query advertisement failure
	- displayes MLD group management info in dump

2003-01-22  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6: supported the elapsed time DHCPv6 option:
	- the client now includes the option for all messages.
	- the server logs the received option, though it does not care
	about the option value.

2003-01-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6: supported the Release message:
	- client now releases stateful resources before exiting or restarting
	  by sending the message.
	- server now accepts the message and releases the corresponding
	  binding.

Tue Jan 21 17:02:57 JST 2003  itojun@iijlab.net
	* sys/mbuf.h: switch from m_aux framework to m_tag framework (from
	  openbsd) for tagging extra information to mbuf chain.
	  TODO: bsdi4

2003-01-20  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/ndp/ndp.c (ifinfo): printed the max MTU for ndp -i IFNAME.

2003-01-20  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/(several files): clarified library interfaces
	for prefix manipulation.  There was no change on behavior.

Mon Jan 20 keiichi@iij.ad.jp
	* kame/sys/netinet6/mip6_pktproc.c
	fixed a bug that the correpondent node doesn't send back a
	binding ack even when the ACK bit is on.
	reported by Yukiyo Akisada <Yukiyo.Akisada@jp.yokogawa.com>.

Fri Jan 17 20:53:58 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet6/mip6_pktproc.c:
	more sanity checks.  a home test init and a care-of test init
	must not contain a home address destination option.
	reported by Yukiyo Akisada <Yukiyo.Akisada@jp.yokogawa.com>.

Fri Jan 17 19:28:45 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet6/mip6_binding.c:
	fixed a bug that sending with an invalid lifetime from a home
	agent when unregistering.
	reported by Yukiyo Akisada <Yukiyo.Akisada@jp.yokogawa.com>.

Fri Jan 17 19:18:44 JST 2003	keiichi@iij.ad.jp
	* kame/sys/netinet/icmp6.h:
	corrected the dhaad reply format.
	reported by Yukiyo Akisada <Yukiyo.Akisada@jp.yokogawa.com>.

Fri Jan 17 18:08:00 JST 2003	suz@crl.hitachi.co.jp
	* kame/sys/netinet6/ip6_input.c:
	  When listening to a source-specific-multicast group, receives 
	  IPv6 packets (e.g. ICMPv6 ECHO) as well as IPv6 UDP packets
	  if source and group are matched.
	      
Fri Jan 17 12:17:39 JST 2003	suz@crl.hitachi.co.jp
	* kame/sys/net/if_stf.c, kame/kame/rtsold/rtsold.{c,8}
	  rtsold now periodically solicites RA on ISATAP interface.

Sat Jan 11 16:25:06 JST 2003	suz@crl.hitachi.co.jp
	* bsdi4/sys/conf/files, bsdi4/sys/sys/sockio.h, bsdi4/sbin/ifconfig:
	  ISATAP implementation for bsdi4 (just confirmed compilation)

Fri Jan 10 17:27:10 JST 2003	suz@crl.hitachi.co.jp
	* kame/sys/net/if_*.c:
	  fixed a bug that some interfaces cannot be manipulated under
	  OpenBSD+KAME.

Thu Jan  9 20:10:24 JST 2003	suz@crl.hitachi.co.jp
	* {netbsd,openbsd}/sys/conf/files, {netbsd,openbsd}/sys/sys/sockio.h,
	  {netbsd,openbsd}/sbin/ifconfig, kame/sys/net/if_stf.c:
	  ISATAP implementation for NetBSD/OpenBSD.

Wed Jan  8 14:33:42 JST 2003	suz@crl.hitachi.co.jp
	* kame/kame/man/man4/stf.4, kame/sys/net/if_stf.[ch],
	  kame/sys/netinet6/in6.h, in6_ifattach.c, ip6_input.c,
	  freebsd4/sys/sys/sockio.h, freebsd4/sys/net/if.h:
	  ISATAP kernel implementation based on
	  draft-ietf-ngtrans-isatap-08.txt for FreeBSD-4.
	* kame/kame/rtadvd, kame/kame/rtsold, freebsd4/sbin/ifconfig
	  ISATAP userland implementation based on 
	  draft-ietf-ngtrans-isatap-08.txt for FreeBSD-4.
	  
	please see "man stf" for further detail.

Wed Jan  8 14:26:17 JST 2003  itojun@iijlab.net
	* sys/netkey/keydb.h: in struct secashead, "struct route" is not
	  sufficient if !NEW_STRUCT_ROUTE.  NetBSD PR 18751.

2003-01-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dhcp6: upgraded base specification of DHCPv6 and prefix
	delegation using DHCPv6 according to the latest drafts.
	Note that backward compatibility to older versions of prefix
	delegation was not provided.
