			CHANGELOG for KAME kit

$KAME: CHANGELOG,v 1.1552 2001/02/11 22:52:36 itojun Exp $

<200102>
2001-02-11  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6if_do_dad): was added to centralize
	the decision of whether DAD should be performed on a particular
	interface.  This function is currently called from
	in6_update_ifa() and in6_ifattach_linklocal().

2001-02-09  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6_ifattach.c (in6_ifattach): skipped
	assignment of link-local addresses when interfaces become up,
	if ip6_auto_linklocal is 0 (its default is 1).  By setting 0 to
	this variable and manually configuring link-local addresses, you
	can use well-known interface identifiers for servers/router/etc.
	This variable can be configured via sysctl
	net.inet6.ip6.auto_linklocal or by the IP6_AUTO_LINKLOCAL kernel
	compilation option.  If you configure the variable via sysctl, you
	should be sure that all interfaces are NOT up.
	Note that the variable effects all interfaces.  When you set 0 to
	the variable, you should configure link-local addresses for all
	interfaces that you might want to use.
	
Fri Feb  9 00:51:01 JST 2001  itojun@iijlab.net
	* sys/netinet6/in6.h: correct SA6_ARE_ADDR_EQUAL definition.
	  kernel responds to ping6 -w again.

Fri Feb  9 00:18:46 JST 2001  itojun@iijlab.net
	* sys/netinet6/icmp6.c: negative {mtudisc,redirect}_{hi,lo}wat
	  value will turn off the checks.  See changelog on 2000/12/09.

2001-02-08  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/nd6.c (nd6_free): returned the pointer to the
	next entry of the freed one.  Since pfxlist_onlink_check() called
	from this function could change the link structure, the caller
	would need the "real" successor of the list to avoid to refer to
	invalid memory.  This fix actually fixed a problem that the kernel
	hunged in some (rare) cases.

Wed Feb  7 21:35:26 JST 2001  itojun@iijlab.net
	* sys/kern/uipc_socket.c (netbsd/openbsd/freebsd4/bsdi4):
	  return ECONNABORTED, if the socket (tcp connection for example)
	  is disconnected by RST right before accept(2).  fixes PR 10698/12027.
	  checked with SUSv2, XNET 5.2, and Stevens (unix network programming
	  vol 1 2nd ed) section 5.11.
	  bsdi3/freebsd[23] needs some other fix here, so they are left behind.

2001-02-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/usr.sbin/netstat/route.c (p_sockaddr): removed special
	cases of ::/plen (plen > 0).  I believe it is better than the
	original behavior, which printed those routes "v6-in-v4 default".

Wed Feb  7 16:19:19 JST 2001  itojun@iiljab.net
	* sys/netinet6/raw_ip6.c (netbsd/openbsd): validate/notify path MTU
	  discovery correctly for raw ip6 sockets.
	  note: since ping6 does not use connect(2) for the socket for
	  outgoing traffic, ping6 will have issues with route pointer kept
	  in in6pcb - need to restart ping6 to reflect new pmtu.

Wed Feb  7 01:08:46 JST 2001  itojun@iijlab.net
	* netbsd/sys/net/route.c: ignore redirect attempt, if we are to
	  create/update routing entry with the same value in rt_key and
	  rt_gateway.  response to NetBSD PR 4827.  experimental.

2001-02-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/nd6.c (nd6_p2p_rtrequest): removed.  It was
	introduced long long ago, and is not necessary any more,
	especially after the recent clarification on the address/prefix
	management.

Tue Feb  6 13:08:24 JST 2001 itojun@iijlab.net
	* sys/netinet6/nd6*.c: minimize number of log() or printf() on inbound
	  packet processing path, to avoid /var from get filled up with with
	  bogus packet storms.
	* sys/netinet6/icmp6.c: supply new sysctl net.inet6.icmp6.nd6_debug,
	  to turn on/off error/warning messages on inbonud ND/ICMPv6 packets.
	  disabled by default, can be enabled by default if you have
	  "options ND6_DEBUG".
	* sys/netinet6: OLD_LOOPBACK_IF is no longer supported (see changelog
	  on 2000/7/30).

2001-02-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6_update_ifa): always set the
	destination address when specified regardless of the type of the
	interface.  This would solve a problem that bsdi3 could not add a
	route that has ::1 as the gateway (bsdi3 specific, maybe).
	This fix was in response to a report from Tomomi Suzuki
	<stomomi@ebina.hitachi.co.jp>.

Tue Feb  6 10:49:36 JST 2001  itojun@iijlab.net
	* sys/netinet6/ip6_output.c: correct m->m_pkthdr.rcvif setting for
	  own linklocal address cases.  broken around Feb 2.

2001-02-05  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* *BSD/sbin/ifconfig/ifconfig.c: marked "temporary" for temporary
	IPv6 addresses (see the next log).

2001-02-05  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/: implemented RFC 3014 Privacy Extensions for
	Stateless Address Autoconfiguration.  You can enable this by
	# sysctl -w net.inet6.ip6.use_tempaddr=1
	before accepting an RA.  Once enabled, the kernel will configure
	temporary addresses as well as public autoconfigured ones, as
	described in the RFC.  Also, the kernel will prefer temporary
	addresses to public autoconfigured ones as the source address for
	a new communication.  For more details about the selection
	algorithm, see 1.6 of the KAME IMPLEMENTATION file.

2001-02-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6 (bunch of files): completely revisited address
	and prefix manipulation:
	- centralize addition or removal of addresses to make code
	  maintainance easier.
	- separate address manipulation and prefix manipulation, including
	  + completely separate address lifetimes and prefix lifetimes.
	  + separate on-link determination from address autoconfiguration.
	  + separate route for a node's own address (to a loopback
	    interface) from an interface's direct route.
	  + separate the notion of detached addresses and the notion of
	    detached prefixes.  The latter can now be designated by the
	    "D" bit of the output from "ndp -p".
	- more conformance to RFC 2462 address autoconfiguration.
	- clarify a notion of autoconfigured addresses.

	Note: the change is so drastic, so you will probably have to clean
	all your source tree up, and then rebuild the entire kernel and
	applications.

2001-02-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.h (IFA6_IS_{DEPRECATED, INVALID}): added
	to hide implementation of address lifetimes.  As a middle term
	solution, we should clarify the relationship among ia6t_xxx
	members and the IN6_IFF_DEPRECATED flag.  When you add code about
	address lifetimes, do not assume its implementation, and stick to
	use these macros.

2001-02-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/rtadvd/rtadvd.c (main): the -R (router renumbering)
	option is currently ignored (with a warning message).  We will
	re-enable the option after clarifying the address/prefix
	manipulation in the kernel, and implementing missing stuff within
	rtadvd (hopefully soon).

2001-02-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/prefix/prefix.sh (prefix): added as a tiny replacement
	of original prefix(8), based on recent clarification on the kernel
	prefix/address manipulation engine.  "Tiny" means that it does NOT
	provide complete backward compatibility with the original one.  It
	can just do simple set/delete operations using ifconfig(8) as a
	backend.  Thus, users are rather recommended not to use the prefix
	command, but should use ifconfig (8) explicitly.

Sun Feb  4 11:21:15 JST 2001  itojun@iijlab.net
	* freebsd*: do not remove prefix list on net.inet6.ip6.forwarding
	  change from 0 to 1.  the behavior is confusing, and not friendly
	  with recent changes to on-link determination logic.

2001-02-01  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/rtadvd/config.c (getconfig):
	* kame/kame/rtadvd/advcap.c (agetnum):
	use a long long integer to parse numeric values to unitentional
	overflow for 32 bits integers.  With this change, you can specify
	very large value (i.e. values larger than 0x80000000) for valid
	and preferred lifetimes.
	XXX: we assume the type "long long" is more than 32 bits in length.

2001-02-01  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* {bsdi[34],freebsd4,netbsd,openbsd}/sbin/ifconfig/ifconfig.c:
	added a new modifier "autoconf" for IPv6 addresses.
	For example, when you configure an IPv6 address like this
	# ifconfig ne0 inet6 3ffe:ffff::1 prefixlen 64 autoconf
	and a router advertises RA with the prefix information for
	3ffe:ffff::, then the lifetimes of the address will be adjusted
	according to the RA.

<200101>
Wed Jan 31 17:43:23 JST 2001 sakane@ydc.cojp
	* racoon:
	If the file for saving SA information is specified in the
	configuration file, racoon will save a SA information to the file
	when negotiation will succeed.  If you launch racoon with tye -B
	option and if the file is specified, she will install SAs into the
	kernel during intialization.  racoon cleans the file when she
	shutdowns normally.  The function is useful when an abnormal
	system shutdown happened, because SAs will remain at the peer.  In
	this case, you can use the -B option then SAs will revive.

	XXX racoon simply adds SAs to the end of the file specified.

Tue Jan 30 05:03:01 JST 2001  itojun@iijlab.net
	* route6d: corrected RTA_NETMASK handling (do not look at sa_family).
	  bug report from IIJ SEIL team.

Mon Jan 29 JST 2001  itojun@iijlab.net
	* {freebsd*,openbsd}/ports/bind: disable it for security issues.
	  these were based on 8.1.2...
	* freebsd4/include/netdb.h: do not pollute namespace by inclusion of
	  sys/types.h.  declare _BSD_SOCKLEN_T_ in machine/ansi.h, avoid
	  duplicated declarations.
	  based on SUSv2, netdb.h should not pull in sys/types.h.
	  if your code become not compilable due to the change, it is because
	  of bug (or SUSv2 non-conformance) in your code.
	  (you can't assume that netdb.h would pull in sys/types.h)

Mon Jan 29 00:24:00 JST 2001  itojun@iijlab.net
	* sys/netinet/icmp6.h: synchronize some of declarations, like RA packet
	  header structure and value #defines with 2292bis-02.

Sun Jan 28 JST 2001  itojun@iijlab.net
	* netbsd: synchronize with netbsd-current change to cloning routes.
	  (1) cloning routes will be marked with RTF_CLONED.  (2) RTF_CLONED
	  routes go away when RTF_CLONING routes go away (= ARP cache goes away
	  when interface address goes away)  (3) permit overwrite of RTF_CLONED 
	  by static route settings.

2001-01-27  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/libinet6/getaddrinfo.c: obsoleted EAI_ADDRFAMILY and
	EAI_NODATA according to the rfc2553bis-02 draft.
	* {bsdi3, freebsd4, netbsd, openbsd}/include/netdb.h:
	* bsdi4/contrib/bind/src/include/netdb.h:
	removed the definition of the obsoleted error types.  In order to
	minimize the possibility of binary compatibily breakage, we did
	not reorder the error number sequence.

Fri Jan 26 00:12:48 JST 2001  itojun@iijlab.net
	* bsdi3: support ART routing table lookup algorithm.
	* bsdi4: support ART routing table lookup algorithm.  inet6 only
	  due to the use of custom host lookup logic in inet.

Thu Jan 25 12:26:32 JST 2001 sakane@ydc.co.jp
	* racoon:
	Fixed to handle variable-length DH shared secret correctly.
	from <yamaya@inf.furukawa.co.jp>

Wed Jan 24 10:31:29 JST 2001  itojun@iijlab.net
	* sys/netinet6/ip6_fw.[ch]: pull security patch (fixes "established"
	  tcp filter) from FreeBSD-SA-01:08.ipfw.
	  NOTE: IPv4 ip_fw.[ch] on freebsd[234] are NOT patched (yet).

Wed Jan 24 09:32:16 JST 2001  itojun@iijlab.net
	* sys/net/radix_art.[ch]: ART routing table lookup algorithm.
	  (memory eater, but should be faster).  currently netbsd/openbsd only.

Wed Jan 24 02:46:42 JST 2001  itojun@iijlab.net
	* netbsd: make MIP6 kernel compile again.

2001-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/rtadvd/config.c (getconfig): made sure to zero-clear
	manually configured prefix information structures.  Without this,
	rtadvd would not work when you configure advertised prefixes
	manually.  Please be sure to update.  This bug seemed to be
	introduced on around 2000-11-11.

Tue Jan 23 22:14:08 JST 2001  itojun@iijlab.net
	* freebsd4: share sys/netinet6/ipsec.h.  sys/netinet6/ipsec6.h is gone.
	  NOTE: "make TARGET=freebsd4 clean" is necessary on upgrade.

2001-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6_update_ifa, in6_ifscrub):
	considered cases where multiple addresses with a same single
	prefix are assigned on multiple interfaces.  For example, you can
	configure
	# ifconfig ne0 3ffe:ffff::1111 alias
	# ifconfig ne1 3ffe:ffff::aaaa alias
	then both two addresses can be assigned on ne0 and ne1, resp., and
	the corresponding interface route 3ffe:ffff::/64 goes to the
	interface ne0 (i.e. 1st cofirgured one wins).  If you then delete
	the address on ne0, the interface route switches the associated
	interface to ne1.
	(we do not recommend users such a configuration, though).

Tue Jan 23 18:09:08 JST 2001  itojun@iijlab.net
	* sys/netinet6/ip6_input.c: declare ip6aux structure, which is used
	  to pass around information about the packet, across header processing
	  routines.  we plan to put header chain parsing history into here.
	* sys/netinet6/dest6.c: support home agent destination option.
	  it is made mandatory by mobile-ip6 spec.
	  XXX may have broke ericsson mobile-ip6

2001-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/net/if_gif.c (gif_ioctl): set IFF_RUNNING upon sucess
	of the SIOCSIFPHYADDR ioctl (and its variations).  This is
	necessary to perform DAD on a gif interface.

2001-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6_ifinit): clarified on installation
	of interface direct routes;
	- made an interface route only when
	  + prefixlen is smaller than 128, or
	  + the destination address is specified.
	- set the cloning bit of an interface route only when the prefix
	  length is smaller than 128.  And, in this case, the bit is
	  always set regardless of the interface type.  In particular, an
	  interface route with the cloning bit would be configured on a
	  p2p interface.
	This mean you can now invoke the following command:

	# ifconfig gif0 inet6 3ffe:ffff::1

	Note that there is no destination address specified, and the
	prefix length is implicitly set 64.  Also note that the
	corresponding interface route of the address would have the
	cloning bit, and neighbor caches would be created when you try to
	communicate with a destination that matches the prefix
	3ffe:ffff::/64.
	
	In summary, by the two consecutive changes, the only possible
	commands you can type are:
	# ifconfig gif0 inet6 IPv6address prefixlen plen
	(where IPv6address is an IPv6 address, plen < 128) and
	# ifconfig gif0 inet6 IPv6address IPv6dstaddress prefixlen 128	
	(where IPv6address and IPv6dstaddress are IPv6 addresses)

2001-01-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6_update_ifa): made the argument
	validation stricter; if a destination address is specified for the
	SIOCAIFADDR_IN6 ioctl, its prefix MUST be 128. As an effect, the
	kernel now refuses the following command:
	# ifconfig gif0 inet6 3ffe:ffff::1 3ffe:ffff::2 alias
	(note that the default prefix length is 64).
	You should explicitly specify 128 as the prefix length:
	# ifconfig gif0 inet6 3ffe:ffff::1 3ffe:ffff::2 prefixlen 128 alias

	You may think this is too restrictive, but I believe it's better
	than before. We've seen many users confused about configration of
	p2p interfaces.

Tue Jan 23 13:51:34 JST 2001  itojun@iijlab.net
	* sys/netinet6/ipsec.c: record IPsec decapsulation history information,
	  so that we can use it for validating inbound packets at L4.
	* netbsd: run ipfilter only for wire format packets, not the IPsec-
	  decapsulated ones.
	  
Tue Jan 23 03:44:03 JST 2001  itojun@iijlab.net
	* netbsd/openbsd: make sure do not return garbage, when accept(2) is
	  called after socket is disconnected (like RST right after TCP
	  establishment).

Mon Jan 22 JST 2001  itojun@iijlab.net
	* route6d: advertise aggregated route, only to interfaces specified
	  after -A option.  found by IIJ IPv6 router torture testers.

2001-01-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/nd6_rtr.c (in6_{ifadd, ifdel}): ifa_refcnt
	clarifications:
	- do not IFAREF in in6_ifadd() (except on nbsd)
	- do not duplicate IFAFREE in in6_ifdel() (except on nbsd)
	without these changes, a manually configured ifaddr would be freed
	two times when its lifetime expired. Although such a situation
	would be rare, all *BSD (except NetBSD)	users (who use versions
	after Jan 2, 2001) are recommended to apply this fix.

Sun Jan 21 JST 2001  itojun@iijlab.net
	* libinet6/getaddrinfo.c: disallow invalid scope identifier
	  (like fe80::1%junk).  it was broken around Jan 5 2001.

2001-01-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sbin/ifconfig/ifconfig.c (main): set IPv6 address
	lifetimes correctly (i.e. set infinite). Without this, ifconfig
	would not be able to assign IPv6 addresses.

Sun Jan 21 00:26:47 PST 2001  itojun@iijlab.net
	* sys/netinet6/ip6_input.c: do not accept packet to link-local address
	  on loopback interface, if the destination address is not assigned
	  to the node itself.  fixes KAME PR 250.

Sun Jan 21 01:37:23 2001  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* sys/netinet6/{nd6.c,nd6_nbr.c,nd6.h}: implement garbage
	  collection for a stale NDP entry, as described in RFC2461
	  5.3. Each entry will be removed in 1day by default.

2001-01-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/bin/ping/ping.c: corrected the output format when the
	command is build without "INET6" being defined.

2001-01-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/netinet/udp_usrreq.c (udp_input):
	* bsdi4/sys/netinet/tcp_input.c (tcp_input):
	made a local copy of the IPv6 header and called in6_clearscope()
	(which was newly implemented with this change) to remove
	(possibly) embedded scope identifiers.
	XXX: this change would reduce efficiency, but is necessary to
	compute checksum correctly for a packet with scoped source or
	destination addresses.
	All BSD/OS 4.2 users are recommended to apply this fix.

Sat Jan 20 JST 2001  itojun@iijlab.net
	* sys/netinet6/ipsec.c: candidate fix for KAME PR 233 (tunnelled packet
	  may cause bad ARP).

Fri Jan 19 17:09:17 JST 2001  itojun@iijlab.net
	* sys/netinet/icmp6.h: synchronize RR flag bit definitions to
	  RFC2894.  you need to compile every system you have, to make RR work.
	  KAME PR 300.

2001-01-19  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/i386/isa/if_ef.c (efintr): do not use the sentinel
	pointer stored in ef_mb, and force the EF_NEWM macro to create a
	fresh mbuf chain to store incoming ether frames (with mbuf cluster
	if necessary). This fix is essential to the KAME IPv6 stack
	(without the m_pulldown stuff), so please be sure to apply this
	fix if you use IPv6 on an interface using the ef driver.

2001-01-18  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/contrib/bind/src/lib/irs/{lcl,nis}_ho.c: set ho_addrinfo
	function(s) properly. Without this fix, getaddrinfo() could cause
	SEGV when "local" or "nis" is specified to look hosts up. Be sure
	to update.

Thu Jan 18 02:00:32 JST 2001  itojun@iijlab.net
	* netbsd, openbsd, bsdi4: fix unsafe typecast in rtrequest1().
	  clarify 3rd arg handling in eonrtrequest().
	* netbsd, openbsd: integrate post-4.4BSD rtrequest1(), and argument
	  type change on ifa_rtrequest (3rd arg).

2001-01-16  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/dtcp/dtcps.rb (tunnelcleanup): deleted the pair of
	physical addresses by "gifconfig delete" after the session. This
	would prevent a garbage pair.

Tue Jan 16 00:43:19 JST 2001  itojun@iijab.net
	* sys/netinet6/mld6.c: emit MLD6 packet correctly (MTU setting was
	  wrong and the packet did not go out of the node).  the bug was
	  introduced around November 27, 2000.

Mon Jan 15 12:53:37 JST 2001  yu-inoue@jp.fujitsu.com
	* route6d:
	  when an interface goes down, do not advertise routes associated with
	  the interface, more like vendor routers.  by doing so, we can
	  avoid blackhole route (advertised even though the router lost
	  reachability), and we can switch to alternate route if one exists.
	  NOTE: it may cause reachability problem to the router itself, if
	  the router has interfaces without global addresses.

Sat Jan 13 12:45:56 JST 2001  itojun@iijlab.net
	* sys/netinet/ip_output.c: allow interface index to be specified with
	  multicast set/getsockopts, by using 0.0.0.0/8 (= pass it as network
	  endian value, 24bit in in_addr).  follows RFC1724 section 3.3.
	  suggested by Dave Thaler.

Fri Jan 12 18:54:52 JST 2001  itojun@iijlab.net
	* bsdi4: use BSD/OS 4.2 as the base version.

Thu Jan 11 02:47:37 JST 2001 sakane@ydc.co.jp
	* kame/sys/netkey/key.c:
	- key_acquire() does not require a secpolicy structure.
	  There was a possibility of kernel panic.
	  reported by <dwang@iPolicyNet.COM>.

Thu Jan 11 02:46:09 JST 2001 sakane@ydc.co.jp
	* racoon:
	- saved the type of SA in PF_KEY acquire message from the kernel
	  in order to reply a error.
	- removed from the scheduler immediately if error happened when sending
	  phase 1 initiation message.

Wed Jan 10 11:41:30 JST 2001 sakane@ydc.co.jp
	* racoon:
	- Fixed to configure the logging level.  racoon saves some parameters
	  before parsing configuration file in order to prefer the parameters
	  by command line.

Wed Jan 10 00:19:59 JST 2001  itojun@iijlab.net
	* sys/netinet6/icmp6.c: fix SEGV on icmp6 redirect input.
	  openbsd/netbsd only.  was introduced early Dec2000.

Tue Jan  9 16:50:07 JST 2001  itojun@iijlab.net
	* kame/libinet6/getaddrinfo.c: share getaddrinfo source code (again)
	  across all platforms we have.  though we have a jumbo #ifdef at the
	  bottom for DNS lookup portion, it is good to share the core logic.
	  while we are at it, simplify lots of things.
	  freebsd4 behavior change: $GAI support is dropped.  classful notation
	  (127.1) is dropped.

2001-01-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6_pcb.c (in6_pcbnotify):
	* {bsdi4,freebsd[34],openbsd}/sys/netinet6/in6_pcb.c (in6_pcbbind):
	allowed an application to bind a socket to a deprecated address.
	For openbsd, a new check if the specified address is a node's own
	address was added as well.

2001-01-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* freebsd3/ports/libbind8: newly added based on BIND 8.2.2p7. This
	libbind supported A6 and DNAME.

2001-01-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/prefix/prefix.c: changed the default values of
	prefixes to infinity. Finite default values were bad, because they
	would be installed as the lifetimes of routers' addresses, which
	would never increment and be invalidated in the future.

	NOTE: if you use the kernel that has the change made on 2000-12-03
	by Koji Kawano (see CHANGELOG.2000) on a router box, and use the
	prefix command to assign addresses for the router, please be sure
	to update the prefix command and reboot the router (or at least
	reassign the addresses by the new prefix command). The lifetimes
	might now be decresing, and will expire in the near future.

	We'd even recommend you not to use the prefix command. It has
	recently caused many problematic situations, and almost no one
	understands the kernel prefix management routines well. You can do
	the same thing by the ordinally ifconfig command. See the latest
	rc.net6.sample file.

2001-01-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/etc/rc.net6: prohibit the prefix command by default.
	Since the command has recently caused many problems, we should
	reconsider the prefix management mechanism.

Fri Jan  5 22:51:16 JST 2001  itojun@iijlab.net
	* libinet6/name6.c: nuke getnodeby{name,addr}, which was mentioned
	  only in draft-ietf-ipngwg-bsd-api-new-01.txt.

Fri Jan  5 13:24:21 JST 2001  itojun@iijlab.net
	* getaddrinfo.c (shared/netbsd/openbsd/freebsd4)
	  query DNS only once per an AF.

2001-01-05  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/contrib/bind/src/lib/irs/gethostent.c: allowed gethostbyname
	to accept abbreviated IPv4 text addresses (like 127.1).
	(XXX: this change is against a bind8 policy, but just for backward
	compatibility.)

2001-01-02  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* freebsd3/lib/libinet6/Makefile: do not link resolver files when
	USE_LIBBIND6 is YES, so that enhanced libbind could be tested.
	* freebsd3/*/Makefile.inc: when USE_LIBBIND6 is YES, link libbind
	(as well as libinet6).

Tue Jan  2 17:15:44 JST 2001  itojun@iijlab.net
	* sys/netinet6/in6{,_ifattach}.c: correct use of IFAREF/IFFREE on
	  non-netbsd operating systems.  old code had memory leak possibility
	  on SIOCDIFADDR_IN6.  reported by hitachi guys.

2001-01-01  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/lib/libinet6:
	* bsdi4/contrib/bind/src/lib:
	massive improvements on DNS resolver including
	- IPv6 transport of DNS resolver. An IPv6 textual address can now
	  be in the /etc/resolv.conf file as a DNS server.
	- support of A6 and DNAME with bit string labels. They are still
	  very experimental, and thus disabled by default. "options a6"
	  and "options dname" in the /etc/resolv.conf file would enable A6
	  and DNAME, respectively.
	- EDNS0 OPT RR support with UDP buffer size negotiation. which is
	  disabled by default, and would enabled by "options edns0" in the
	  /etc/resolv.conf file.
	- clarification on the relationship between address family and irs
	  functions. For example, if you call getaddrinfo with AF_UNSPEC,
	  and irs.conf specifies to consider the local hosts file first,
	  then getaddrinfo would try to resolve an address in the
	  following order:
	  + IPv6 addresses in the hosts file.
	  + IPv4 addresses in the hosts file.
	  + IPv6 addresses via DNS.
	  + IPv4 addresses via DNS.
	  And, if one of the first two attempts succeeded, the remaining
	  two methods would be skipped. This change of the behavior would
	  be useful if you put both IPv6 and IPv4 addresses in the hosts
	  file, and do not want to see redundant DNS packets.
