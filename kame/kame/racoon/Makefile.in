# YIPS $Id: Makefile.in,v 1.8 2000/01/09 01:31:19 itojun Exp $

@SET_MAKE@
srcdir=	@srcdir@
VPATH=	@srcdir@
CC=	@CC@
LDFLAGS=@LDFLAGS@
CPPFLAGS=	@CPPFLAGS@
OPTFLAG=@OPTFLAG@
CFLAGS=	@CFLAGS@ @CPPFLAGS@ @DEFS@ $(CPPFLAGS) $(OPTFLAG) -DIPSEC -I. -I$(srcdir) -Dss_family=__ss_family -Dss_len=__ss_len @SSLVERDEF@
CFLAGS+=-DYY_NO_UNPUT
LIBS=	@LIBS@
YFLAGS+=-d

prefix=	@prefix@
bindir=	@bindir@
mandir=	@mandir@
exec_prefix=	@exec_prefix@
INSTALL=@INSTALL@

PROG=	racoon kmpstat eaytest
#PROG+=	pfkey signing
OBJS=	main.o session.o isakmp.o handler.o \
	isakmp_ident.o isakmp_agg.o \
	isakmp_quick.o isakmp_inf.o isakmp_newg.o \
	pfkey.o admin.o ipsec_doi.o oakley.o grabmyaddr.o signing.o \
	policy.o localconf.o remoteconf.o crypto_openssl.o algorithm.o \
	cfparse.o cftoken.o strnames.o \
	vmbuf.o plog.o logger.o schedule.o str2val.o misc.o sockmisc.o \
	@LIBOBJS@
#OBJS+=	signing.o

all: $(PROG)

racoon: $(OBJS)
	$(CC) $(LDFLAGS) -o $@ $(OBJS) $(LIBS)

kmpstat: kmpstat.o misc_noplog.o vmbuf.o str2val.o
	$(CC) $(LDFLAGS) -o $@ kmpstat.o misc_noplog.o vmbuf.o str2val.o $(LIBS)

pfkey: dummy.o
	$(CC) $(LDFLAGS) -o $@ dummy.o

eaytest: eaytest.o crypto_openssl.o misc_noplog.o vmbuf.o str2val.o
	$(CC) $(LDFLAGS) -o $@ eaytest.o crypto_openssl.o misc_noplog.o \
		vmbuf.o str2val.o $(LIBS)

signing: signing.o
	$(CC) $(LDFLAGS) -o $@ signing.o

# special object rules
misc_noplog.o: misc.c
	$(CC) -DNOUSE_PLOG -o misc_noplog.o -c misc.c

# extra
print-isakmp.o:	$(srcdir)/../tcpdump/print-isakmp.c
	$(CC) $(CFLAGS) -c $(srcdir)/../tcpdump/$*.c

# missing/*.c
strdup.o:	$(srcdir)/missing/strdup.c
	$(CC) $(CFLAGS) -c $(srcdir)/missing/$*.c
getaddrinfo.o:	$(srcdir)/missing/getaddrinfo.c
	$(CC) $(CFLAGS) -c $(srcdir)/missing/$*.c
getnameinfo.o:	$(srcdir)/missing/getnameinfo.c
	$(CC) $(CFLAGS) -c $(srcdir)/missing/$*.c

.c.o:
	$(CC) $(CFLAGS) -c $<

tag:
	ctags -dtw $(srcdir)/*.[chly]

install:
	$(INSTALL) -s -o bin -g bin -m 555 racoon $(prefix)/sbin
	$(INSTALL) -o bin -g bin -m 444 racoon.8 $(mandir)/man8
	$(INSTALL) -o bin -g bin -m 444 racoon.conf.5 $(mandir)/man5

clean:
	-rm -f $(PROG) *.o *.core y.tab.h

distclean: clean
	-rm -f Makefile config.cache config.status config.log

depend:
	mkdep ${CFLAGS:M-[ID]*} $(srcdir)/*.c
