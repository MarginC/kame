.\" Copyright (C) 1995, 1996, 1997, and 1998 WIDE Project.
.\" All rights reserved.
.\" 
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 3. Neither the name of the project nor the names of its contributors
.\"    may be used to endorse or promote products derived from this software
.\"    without specific prior written permission.
.\" 
.\" THIS SOFTWARE IS PROVIDED BY THE PROJECT AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE PROJECT OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.Dd Aug 13, 1999
.Dt RACOON.CONF 5
.Os KAME
.\"
.Sh NAME
.Nm racoon.conf
.Nd configuration file for racoon
.\"
.\" .Sh SYNOPSIS
.\"
.Sh DESCRIPTION
.Nm
is the configuration file for the
.Xr racoon 8
ISAKMP daemon,
negotiating security association for myself and IPsec.
This is consists of a sequence of directives and statements like C code.
Each directives are composed by a tag and a enclosed by '{' and '}'
in which some statements are composed of tokens separated by white space,
which can be any combination of blanks, tabs.
Lines beginning with
.Ql #
are comments.
.\"
.Ss Meta Syntax
Keywords and special characters that the parser expects exactly are
displayed using the
.Ic bold
font.
Parameters are specifying with
.Ar underline .
Parameters shown in
square brackets
.Po
.Sq [
and
.Sq ]
.Pc
are used to show optional keywords and parameters.
The vertical bar
.Pq Sq \*(Ba
is used to indicate
between a choice of optional parameters.
Parentheses
.Po
.Sq (
and
.Sq )
.Pc
are used to group keywords and parameters when necessary.
Major parameters are listed below.
.Pp
.Bl -tag -width addressx -compact
.It Ar number
means hexa-decimal or decimal number.
The former is expressed with '0x'.
.It Ar string
.It Ar path
.It Ar file
means any string enclosed
.Sq \&"
.Pq double quote .
.It Ar address
means IPv6 and IPv4 address.
.It Ar port
means TCP/UDP port number.
.It timeunit
is one of following:
sec, secs, second, seconds, min, mins, minute, minutes, hour, hours.
.It byteunit
is one of following: B, byte, bytes, KB, MB, TB.
.El
.\"
.Ss Path Specification
.Bl -tag -width Ds -compact
.It Ic path include Ar path ;
specifies a path to include file.
See
.Ic File Include .
.It Ic path pre_shared_key Ar file ;
specifies a file including pre-shared key for various ID.
This file includes some lines of a pair of
.Ar ID
and
.Ar key .
.Ar ID
and
.Ar key
are separated by any number of blanks and/or tab characters.
.It Ic path certificate Ar path ;
racoon will search this directory if the certificate or certificate request
is received.
.El
.\"
.Ss File Include
.Bl -tag -width Ds -compact
.It Ic include Ar file
other configuration file can be included.
.El
.\"
.Ss Identifier Specification
.Bl -tag -width Ds -compact
.It Ic identifier Ic user_fqdn Ar string ;
defines my USER_FQDN included ID payload.
.It Ic identifier Ic fqdn Ar string ;
defines my FQDN included ID payload.
.It Ic identifier Ic keyid Ar file ;
defines my KEY_ID included ID payload.
.El
.\"
.Ss Timer Specification
.Bl -tag -width Ds -compact
.It Ic timer { Ar statements Ic }
specifys default various timer.
.Pp
.Bl -tag -width Ds -compact
.It Ic counter Ar number ;
maximun trying count to send.
.It Ic interval Ar number Ar timeunit ;
maximun interval to resend.
.It Ic persend Ar number ;
the number of packets per a send.
.It Ic phase1 Ar number Ar timeunit ;
.It Ic phase2 Ar number Ar timeunit ;
timer for waiting to complete each phase.
.El
.El
.\"
.Ss Listening Port Specification
.Bl -tag -width Ds -compact
.It Ic listen { Ar statements Ic }
If no
.Ar listen
directive is specified,
.Xr racoon 8
will listen to all available interface addresses.
The followings are the list of statements.
.Pp
.Bl -tag -width Ds -compact
.It Ic isakmp Ar address [ Ar port ] ;
If this(these) is specifyed,
.Xr racoon 8
will only listen to its address.
.It Ic admin Ic [ Ar port ] ;
specify the port for connecting to
.Xr kmpstat 8 .
.It Ic strict_address ;
require all addresses for ISAKMP must be bound.
It will be ignored when you don't specify any addresses.
.El
.El
.\"
.Ss Remote Nodes Specifications 
.Bl -tag -width Ds -compact
.It Xo
.Ic remote ( Ar address \*(Ba Ic anonymous ) [
.Ar port ]
.Ic { Ar statements Ic }
.Xc
definies the parameters of IKE phase 1 per remote node.
The followings are the list of statements.
.Pp
.Bl -tag -width Ds -compact
.\"
.It Ic exchange_mode ( main \*(Ba aggressive \*(Ba base ) ;
defined exchange mode of phase 1.
.\"
.It Ic doi Ar ipsec_doi ;
means to use IPSEC-DOI specifyed RFC 2407.
It must be stated.
.\"
.It Ic situation Ic identity_only ;
It must be stated.
.\"
.It Ic identifier Ar idtype ;
specifies ID type to use phase 1 negotiation.
.Ar idtype
is one of following:
.Ic address , fqdn , user_fqdn , keyid .
These are linked to
.Ic identifier
directive.
.\"
.It Ic certificate_type Ar certspec ;
specifies a certificate specification.
.Ar certspec
is one of followings:
.Bl -tag -width Ds -compact
.It Ic x509 Ar certfile Ar privkeyfile;
.Ar certfile
means a file name of certificate.
.Ar privkeyfile
means a file name of secret key.
.El
.\"
.It Ic lifetime time Ar number Ar timeunit ;
.It Ic lifetime byte Ar number Ar byteunit ;
define default lifetime of phase 1 SA.
.\"
.It Ic keepalive
Not yet.
.\"
.It Ic nonce_size Ar number ;
define the byte size of nonce value.
.\"
.It Xo
.Ic proposal { Ar sub-substatements Ic }
.Xc
.Bl -tag -width Ds -compact
.\"
.It Ic encryption_algorithm Ar algorithm ;
define encryption algorithm for phase 1 negotiation.
.Ar algorithm
is one of following:
.Ic des , 3des , idea , blowfish , rc5 , cast
for oakley.
In the case of other transform, must not use this statement.
.\"
.It Ic hash_algorithm Ar algorithm;
define hash algorithm for phase 1 negotiation.
.Ar algorithm
is one of following:
.Ic md5, sha1
for oakley.
.\"
.It Ic authentication_method Ar type ;
define the authentication method for phase 1 negotiation.
.Ar type
is only one:
.Ic pre_shared_key, rsasig , dsssig , rsaenc , rsarev .
.\"
.It Ic dh_group Ar group ;
define the group of Diffie-Hellman exponentiations.
.Ar group
is one of following:
.Ic modp768 , modp1024 , modp1536 .
When aggressive mode can be used, DH group must be defined and equal
to each proposals's.
.It Ic lifetime time Ar number Ar timeunit ;
.It Ic lifetime byte Ar number Ar byteunit ;
define lifetime of phase 1 SA eay proposal.
.El
.El
.El
.\"
.Ss Policy Specifications 
The policy directive is obsoleted, policies are now in the SPD.
.\"
.Ss Sainfo Specifications
.Bl -tag -width Ds -compact
.It Xo
.Ic sainfo ( Ar source_id destination_id \*(Ba Ic anonymous )
.Ic { Ar statements Ic }
.Xc
definies the parameters of IKE phase 2 (IPSec-SA establishment).
.Ar sainfo_ids
are
.Ic address Ar address [ /
.Ar prefix ] [ Ar port ] Ar ul_proto
or
.Ar idtype Ar string .
.Pp
.Bl -tag -width Ds -compact
.\"
.It Ic pfs_group Ar group ;
define the group of Diffie-Hellman exponentiations.
.Ar group
is one of following:
.Ic modp768 , modp1024 , modp1536 .
.\"
.It Ic lifetime time Ar number Ar timeunit ;
.It Ic lifetime byte Ar number Ar byteunit ;
define default lifetime of IPSec-SA.
.\"
.It Ic identifier Ar idtype ;
specifies ID type to use phase 2 negociation.
.\"
.It Ic encryption_algorithm Ar algorithms ;
.Ic des , 3des , des_iv64 , des_iv32 ,
.Ic rc5 , rc4 , idea , 3idea ,
.Ic cast128 , blowfish , null_enc
for esp.
.\"
.It Ic authentication_algorithm Ar algorithms ;
.Ic hmac_md5, hmac_sha1, none
for esp and ah.
.\"
.It Ic compression_algorithm Ar algorithms ;
.Ic deflate
for ipcomp.
.El
.El
.\"
.Ss Static SA configuration
.Bl -tag -width Ds -compact
.It Ic static_sa Ar parameters
specifies static SA.
This
.Ar parameters
will be passed to
.Xr setkey 8 .
Not yet, but only define.
.El
.\"
.Ss Specifying log file
.Bl -tag -width Ds -compact
.It Ic log ( Ar number \*(Ba Ar level ) ;
define dump level.
It is debugging use.
.Ar is one of following:
.Ic info , notify , debug , debug2 , debug3 , debug4 .
.El
.\"
.Ss Specifying the way to pad
.Bl -tag -width Ds -compact
.It Ic padding { Ar statements Ic }
specifyed padding format.
The followings are the list of statements.
.Bl -tag -width Ds -compact
.It Ic maximum_length Ar number ;
.It Ic randomize (on \(ba off) ;
.It Ic strict_check (on \(ba off) ;
.It Ic exclusive_tail (on \(ba off) ;
.El
.El
.\"
.Sh EXAMPLE
The following shows how remote directive should be configured.
.Bd -literal -offset
remote 172.168.2.2 [7000]
{
	exchange_mode main;

	# default doi is "ipsec_doi".
	doi ipsec_doi;

	# default situation is "identity_only".
	situation identity_only;

	# specify the identifier type
	# "address", "fqdn", "user_fqdn", "keyid"
	identifier user_fqdn;
	certificate_type x509 "mycert" "mypriv";

	# specify the bytes length of nonce.
	nonce_size 16;

	# means to do keep-a-live.  This should not be used in dial-up.
	keepalive;

	# default lifetime, will be copied into each proposals.
	lifetime time 10 min;	# sec,min,hour
	lifetime byte 5 MB;	# B,KB,GB

	proposal {
		encryption_algorithm 3des;
		hash_algorithm md5;
		authentication_method rsasig ;
	}
	proposal {
		encryption_algorithm 3des;
		hash_algorithm md5;
		authentication_method pre_shared_key ;

		# they can be defined explicitly.
		lifetime time 5 min;
		lifetime byte 2 MB;
	}
}
.Ed
.\"
.Sh SEE ALSO
.Xr kmpstat 8 ,
.Xr racoon 8
.\"
.Sh HISTORY
The
.Nm
configuration file first appeared in
.Dq YIPS
Yokogawa IPsec implementation.
.\"
.Sh BUGS
Some statements may not be implemented.
These will be worked in the future.
