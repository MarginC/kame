# YIPS @(#)$Id: policy.conf.in,v 1.5 2000/03/26 10:51:13 itojun Exp $

# IPsec SA configuration

# basic usage is:
#	"policy" local remote protocol direction "ipsec" { ... } ;
#	"policy" local remote protocol direction "discard" ;
#
#		direction := "in", "out", "inout"
#		protocol := "any", "tcp", "udp"
#		action := "discard", "ipsec"
#	

# Fot example.
# 10.1.1.0/24                  10.2.2.0/24
#     --+--                      --+--
#       |                          |
#     +-+-+                      +-+-+
#     | A |==========//==========| B |
#     +---+                      +-+-+
#       172.168.1.1      172.168.2.2
# setting on gateway A:

policy 10.1.1.0/24 10.2.2.0/24 any inout ipsec
{
	# "pfs_group" specifies to require PFS, and defines a DH group number.
	# It is followed by either "modp768", "modp1024" or "modp1536".
	pfs_group modp768;

	# "proposal" defines proposal of IPsec-SA.

	# This proposal means IP2|ESP|IP1|ULP.
	proposal {
		# "lifetime" specifies two type of lifetime of SA.
		lifetime time 200 second;
		lifetime byte 5000 KB;

		# "protocol" defines some of trasnform.
		protocol esp {
			# "level" can be followed by either "require", "use" or
			# "default".  "default" is used if there is no "level".
			level require ;

			# "mode" can be followed by either "tunnel" or "use".
			# If tunnel mode is specified, peer's address must be
			# specified carefully.
			mode tunnel 172.168.2.2;

			# algorithm for ESP encryption
			encryption_algorithm 3des;
		}
	}

	# This proposal means IP2|AH|ESP|IP1|ULP.
	# The order of protocol is very important.  It means SA bundle or
	# nested SAs.
	proposal {
		# "lifetime" specifies some lifetime of SA.
		lifetime time 300 second;
		lifetime byte 10000 KB;

		protocol esp {
			level require ;
			mode tunnel 172.168.2.2;

			# algorithm for ESP encryption
			encryption_algorithm 3des;
		}

		# "ah" means AH.
		protocol ah {
			level require ;
			mode transport ;	# NOTE: not tunnel.
			# algorithm for AH
			authentication_algorithm hmac_md5;
		}
	}
}

policy 172.168.1.1 0.0.0.0/0[7] any in discard ;

policy 172.165.1.1[25] 0.0.0.0/0[25] tcp out ipsec
{
	pfs_group modp1536;

	proposal {
		lifetime time 500 second;
		lifetime byte 1000 KB;
		protocol esp {
			level use ;
			mode transport ;
			# algorithm for ESP encryption
			encryption_algorithm 3des;
			# algorithm for ESP authentication
			authentication_algorithm hmac_md5;
		}
	}
}

