--- shlib/Makefile.in.orig	Fri May 28 01:48:27 1999
+++ shlib/Makefile.in	Tue Mar 28 10:32:11 2000
@@ -61,3 +61,3 @@
 clean:
-	-$(BINRM) *.o $(SHLIB_LIB) so_locations
+	-$(BINRM) *.o *.so $(SHLIB_LIB) so_locations
 
@@ -72,56 +72,94 @@
 msg.o: $(srcdir)/../lib/msg.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/msg.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/msg.c -o msg.so
+	${LD} -x -r msg.so -o msg.o
+	rm -f msg.so
 
 protocol.o: $(srcdir)/../lib/protocol.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/protocol.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/protocol.c -o protocol.so
+	${LD} -x -r protocol.so -o protocol.o
+	rm -f protocol.so
 
 log.o: $(srcdir)/../lib/log.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/log.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/log.c -o log.so
+	${LD} -x -r log.so -o log.o
+	rm -f log.so
 
 hostname.o: $(srcdir)/../lib/hostname.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/hostname.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/hostname.c -o hostname.so
+	${LD} -x -r hostname.so -o hostname.o
+	rm -f hostname.so
 
 confutil.o: $(srcdir)/../lib/confutil.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/confutil.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/confutil.c -o confutil.so
+	${LD} -x -r confutil.so -o confutil.o
+	rm -f confutil.so
 
 buffer.o: $(srcdir)/../lib/buffer.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/buffer.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/buffer.c -o buffer.so
+	${LD} -x -r buffer.so -o buffer.o
+	rm -f buffer.so
 
 cache.o: $(srcdir)/../lib/cache.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/cache.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/cache.c -o cache.so
+	${LD} -x -r cache.so -o cache.o
+	rm -f cache.so
 
 wrap.o: $(srcdir)/../lib/wrap.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/wrap.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/wrap.c -o wrap.so
+	${LD} -x -r wrap.so -o wrap.o
+	rm -f wrap.so
 
 wrap_tcp.o: $(srcdir)/../lib/wrap_tcp.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/wrap_tcp.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/wrap_tcp.c -o wrap_tcp.so
+	${LD} -x -r wrap_tcp.so -o wrap_tcp.o
+	rm -f wrap_tcp.so
 
 wrap_udp.o: $(srcdir)/../lib/wrap_udp.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/wrap_udp.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/wrap_udp.c -o wrap_udp.so
+	${LD} -x -r wrap_udp.so -o wrap_udp.o
+	rm -f wrap_udp.so
 
 conf.o: $(srcdir)/../lib/conf.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/conf.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/conf.c -o conf.so
+	${LD} -x -r conf.so -o conf.o
+	rm -f conf.so
 
 libproto.o: $(srcdir)/../lib/libproto.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/libproto.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/libproto.c -o libproto.so
+	${LD} -x -r libproto.so -o libproto.o
+	rm -f libproto.so
 
 select.o: $(srcdir)/../lib/select.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/select.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/select.c -o select.so
+	${LD} -x -r select.so -o select.o
+	rm -f select.so
 
 rld.o: $(srcdir)/../lib/rld.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/rld.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/rld.c -o rld.so
+	${LD} -x -r rld.so -o rld.o
+	rm -f rld.so
 
 null.o: $(srcdir)/../lib/null.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/null.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/null.c -o null.so
+	${LD} -x -r null.so -o null.o
+	rm -f null.so
 
 addr.o: $(srcdir)/../lib/addr.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/addr.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/addr.c -o addr.so
+	${LD} -x -r addr.so -o addr.o
+	rm -f addr.so
 
 upwd.o: $(srcdir)/../lib/upwd.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/upwd.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/upwd.c -o upwd.so
+	${LD} -x -r upwd.so -o upwd.o
+	rm -f upwd.so
 
 gss.o: $(srcdir)/../lib/gss.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/gss.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../lib/gss.c -o gss.so
+	${LD} -x -r gss.so -o gss.o
+	rm -f gss.so
 
 packet.o: $(srcdir)/../server/packet.c
-	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../server/packet.c
+	$(CC) $(CPPFLAGS) $(CFLAGS) -c $(srcdir)/../server/packet.c -o packet.so
+	${LD} -x -r packet.so -o packet.o
+	rm -f packet.so
